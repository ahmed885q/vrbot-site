"use strict";(()=>{var e={};e.id=1479,e.ids=[1479],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2793:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>x,originalPathname:()=>h,patchFetch:()=>j,requestAsyncStorage:()=>p,routeModule:()=>m,serverHooks:()=>f,staticGenerationAsyncStorage:()=>_,staticGenerationBailout:()=>g});var s={};r.r(s),r.d(s,{GET:()=>d,runtime:()=>c});var a=r(5419),n=r(9108),i=r(9678),o=r(8070),l=r(7439),u=r(7497);let c="nodejs";async function d(){let e=(0,l.cookies)(),t=(0,u.createServerClient)("https://xmanyfpojzkjlwatkrcc.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhtYW55ZnBvanpramx3YXRrcmNjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc2MTc0MTcsImV4cCI6MjA4MzE5MzQxN30.LFW6cNE-oM_Ah8dQL2Dt1xMw8rRWxbHAfPdRnkRvW_U",{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:r,options:s})=>e.set(t,r,s))}catch{}}}}),{data:r}=await t.auth.getUser(),s=r?.user;if(!s)return o.Z.json({error:"Unauthorized"},{status:401});let{data:a,error:n}=await t.from("user_entitlements").select("farm_slots, trial_ends_at").eq("user_id",s.id).maybeSingle();if(n)return o.Z.json({error:n.message},{status:500});if(a){let e=a.trial_ends_at&&new Date(a.trial_ends_at).getTime()>Date.now();return e&&a.farm_slots<1?(await t.from("user_entitlements").update({farm_slots:1}).eq("user_id",s.id),o.Z.json({ok:!0,farm_slots:1,trial_ends_at:a.trial_ends_at})):o.Z.json({ok:!0,...a,trialActive:e})}let i=new Date(Date.now()+6048e5).toISOString(),{data:c,error:d}=await t.from("user_entitlements").insert({user_id:s.id,farm_slots:1,trial_ends_at:i}).select("farm_slots, trial_ends_at").single();return d?o.Z.json({error:d.message},{status:500}):o.Z.json({ok:!0,...c,trialActive:!0})}let m=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/entitlements/ensure/route",pathname:"/api/entitlements/ensure",filename:"route",bundlePath:"app/api/entitlements/ensure/route"},resolvedPagePath:"/workspaces/vrbot-site/app/api/entitlements/ensure/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:p,staticGenerationAsyncStorage:_,serverHooks:f,headerHooks:x,staticGenerationBailout:g}=m,h="/api/entitlements/ensure/route";function j(){return(0,i.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:_})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[1638,6206,3950,7439,7497],()=>r(2793));module.exports=s})();