"use strict";(()=>{var e={};e.id=8103,e.ids=[8103],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},32081:e=>{e.exports=require("child_process")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},73837:e=>{e.exports=require("util")},1034:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>S,originalPathname:()=>x,patchFetch:()=>f,requestAsyncStorage:()=>m,routeModule:()=>_,serverHooks:()=>h,staticGenerationAsyncStorage:()=>v,staticGenerationBailout:()=>b});var s={};r.r(s),r.d(s,{POST:()=>l,runtime:()=>c});var i=r(95419),o=r(69108),n=r(99678),u=r(78070),p=r(28291),a=r(51010);let c="nodejs",d=new p.Z(process.env.STRIPE_SECRET_KEY);async function l(e){let{subscriptionId:t,userId:r}=await e.json(),s=await d.subscriptions.retrieve(t),i=s.data??s,o="number"==typeof i.current_period_end?new Date(1e3*i.current_period_end).toISOString():null,n="active"===i.status||"trialing"===i.status?"pro":"free",{error:p}=await a.p.from("subscriptions").upsert({user_id:r,plan:n,status:i.status??null,stripe_customer_id:"string"==typeof i.customer?i.customer:i.customer?.id??null,stripe_subscription_id:i.id??t,price_id:i.items?.data?.[0]?.price?.id??null,current_period_end:o},{onConflict:"user_id"});return p?u.Z.json({error:p.message},{status:500}):u.Z.json({ok:!0,currentPeriodEnd:o})}let _=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/subscription/sync/route",pathname:"/api/subscription/sync",filename:"route",bundlePath:"app/api/subscription/sync/route"},resolvedPagePath:"/workspaces/vrbot-site/app/api/subscription/sync/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:v,serverHooks:h,headerHooks:S,staticGenerationBailout:b}=_,x="/api/subscription/sync/route";function f(){return(0,n.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:v})}},51010:(e,t,r)=>{r.d(t,{p:()=>s});let s=(0,r(23950).eI)(process.env.SUPABASE_URL,process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[1638,6206,3950,8291],()=>r(1034));module.exports=s})();