"use strict";(()=>{var e={};e.id=4465,e.ids=[4465],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},52520:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>g,originalPathname:()=>j,patchFetch:()=>A,requestAsyncStorage:()=>m,routeModule:()=>d,serverHooks:()=>x,staticGenerationAsyncStorage:()=>I,staticGenerationBailout:()=>h});var s={};r.r(s),r.d(s,{GET:()=>p,runtime:()=>l});var i=r(95419),a=r(69108),n=r(99678),o=r(78070),u=r(7439),c=r(77497);let l="nodejs";async function p(){let e=(0,u.cookies)(),t=(0,c.createServerClient)("https://xmanyfpojzkjlwatkrcc.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhtYW55ZnBvanpramx3YXRrcmNjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc2MTc0MTcsImV4cCI6MjA4MzE5MzQxN30.LFW6cNE-oM_Ah8dQL2Dt1xMw8rRWxbHAfPdRnkRvW_U",{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:r,options:s})=>e.set(t,r,s))}catch{}}}}),{data:r,error:s}=await t.auth.getUser(),i=r?.user;if(s||!i)return o.Z.json({ok:!1,error:"NOT_AUTHENTICATED"},{status:401});let{data:a,error:n}=await t.from("subscriptions").select("plan,status,current_period_end").eq("user_id",i.id).maybeSingle();if(n)return o.Z.json({ok:!1,error:"READ_SUBSCRIPTION_FAILED",details:n.message},{status:500});if(a)return o.Z.json({ok:!0,userId:i.id,email:i.email,...a,trialCreated:!1});let l=new Date(Date.now()+6048e5).toISOString(),{data:p,error:d}=await t.from("subscriptions").insert({user_id:i.id,plan:"trial",status:"trialing",current_period_end:l}).select("plan,status,current_period_end").single();return d?o.Z.json({ok:!1,error:"CREATE_TRIAL_FAILED",details:d.message},{status:500}):o.Z.json({ok:!0,userId:i.id,email:i.email,...p,trialCreated:!0})}let d=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/subscription/ensure-trial/route",pathname:"/api/subscription/ensure-trial",filename:"route",bundlePath:"app/api/subscription/ensure-trial/route"},resolvedPagePath:"/workspaces/vrbot-site/app/api/subscription/ensure-trial/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:I,serverHooks:x,headerHooks:g,staticGenerationBailout:h}=d,j="/api/subscription/ensure-trial/route";function A(){return(0,n.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:I})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[1638,6206,3950,7439,7497],()=>r(52520));module.exports=s})();