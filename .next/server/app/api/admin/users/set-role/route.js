"use strict";(()=>{var e={};e.id=6648,e.ids=[6648],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5909:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>A,originalPathname:()=>g,patchFetch:()=>h,requestAsyncStorage:()=>p,routeModule:()=>c,serverHooks:()=>v,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>f});var s={};t.r(s),t.d(s,{POST:()=>d});var o=t(5419),a=t(9108),n=t(9678),i=t(8070),u=t(3650),l=t(1010);async function d(e){let r=await (0,u.k)();if(!r.ok)return i.Z.json({error:r.error},{status:r.status});let t=await e.json().catch(()=>null),s=t?.userId,o=t?.role;if(!s||!o||!["admin","user"].includes(o))return i.Z.json({error:"Invalid payload"},{status:400});if(s===r.user.id&&"admin"!==o)return i.Z.json({error:"You cannot remove your own admin role"},{status:400});let{error:a}=await l.p.from("user_roles").upsert({user_id:s,role:o},{onConflict:"user_id"});return a?i.Z.json({error:a.message},{status:500}):i.Z.json({ok:!0})}let c=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/admin/users/set-role/route",pathname:"/api/admin/users/set-role",filename:"route",bundlePath:"app/api/admin/users/set-role/route"},resolvedPagePath:"/workspaces/vrbot-site/app/api/admin/users/set-role/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:p,staticGenerationAsyncStorage:m,serverHooks:v,headerHooks:A,staticGenerationBailout:f}=c,g="/api/admin/users/set-role/route";function h(){return(0,n.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:m})}},3650:(e,r,t)=>{t.d(r,{k:()=>o});var s=t(6569);async function o(){let e=(0,s.j)(),{data:r}=await e.auth.getUser(),t=r?.user;if(!t)return{ok:!1,status:401,error:"Unauthorized"};let{data:o}=await e.from("user_roles").select("role").eq("user_id",t.id).maybeSingle();return o&&"admin"===o.role?{ok:!0,user:t}:{ok:!1,status:403,error:"Forbidden"}}},1010:(e,r,t)=>{t.d(r,{p:()=>s});let s=(0,t(3950).eI)(process.env.SUPABASE_URL,process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{persistSession:!1}})},6569:(e,r,t)=>{t.d(r,{j:()=>a});var s=t(7439),o=t(7497);function a(){let e=(0,s.cookies)(),r=process.env.SUPABASE_URL,t=process.env.SUPABASE_ANON_KEY;return(0,o.createServerClient)(r,t,{cookies:{getAll:()=>e.getAll(),setAll(r){try{r.forEach(({name:r,value:t,options:s})=>{e.set(r,t,s)})}catch{}}}})}}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[1638,6206,3950,7439,7497],()=>t(5909));module.exports=s})();