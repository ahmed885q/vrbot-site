"use strict";(()=>{var e={};e.id=2599,e.ids=[2599],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3404:(e,t,a)=>{a.r(t),a.d(t,{headerHooks:()=>w,originalPathname:()=>v,patchFetch:()=>y,requestAsyncStorage:()=>h,routeModule:()=>m,serverHooks:()=>_,staticGenerationAsyncStorage:()=>f,staticGenerationBailout:()=>E});var r={};a.r(r),a.d(r,{GET:()=>l});var s=a(5419),n=a(9108),o=a(9678),i=a(8070),c=a(1010),d=a(9186),p=a(951),u=a(9391);async function l(e){try{await (0,d.k)(e);let t=e.headers.get("x-forwarded-for")?.split(",")[0]??"unknown";await (0,p.h)(t);let{data:a,error:r}=await c.p.from("early_access").select("email, created_at").order("created_at",{ascending:!1});if(r)throw r;let s=a?.map(e=>`"${e.email}","${e.created_at}"`).join("\n")??"";return await (0,u.U)("EARLY_ACCESS_EXPORT_CSV",{count:a?.length??0}),new i.Z("email,created_at\n"+s,{headers:{"Content-Type":"text/csv","Content-Disposition":'attachment; filename="early-access.csv"'}})}catch(e){return i.Z.json({error:e.message??"Export failed"},{status:500})}}let m=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/admin/early-access/export/route",pathname:"/api/admin/early-access/export",filename:"route",bundlePath:"app/api/admin/early-access/export/route"},resolvedPagePath:"/workspaces/vrbot-site/app/api/admin/early-access/export/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:h,staticGenerationAsyncStorage:f,serverHooks:_,headerHooks:w,staticGenerationBailout:E}=m,v="/api/admin/early-access/export/route";function y(){return(0,o.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:f})}},9186:(e,t,a)=>{a.d(t,{k:()=>r});async function r(e,t="read"){let a=e.headers.get("x-admin-token");if(!a||a!==process.env.ADMIN_API_TOKEN)throw Error("Forbidden");let r=process.env.ADMIN_WRITE_TOKEN;if("write"===t&&a!==r)throw Error("Write access required")}},9391:(e,t,a)=>{a.d(t,{U:()=>s});var r=a(1010);async function s(e,t){await r.p.from("audit_trail").insert({event:e,payload:t})}},951:(e,t,a)=>{a.d(t,{h:()=>s});var r=a(1010);async function s(e){let t=new Date(Date.now()-6e4).toISOString(),{data:a}=await r.p.from("rate_limits").select("*").eq("ip",e).gte("created_at",t);if((a?.length??0)>=50)throw Error("Too many requests");await r.p.from("rate_limits").insert({ip:e})}},1010:(e,t,a)=>{a.d(t,{p:()=>r});let r=(0,a(3950).eI)(process.env.SUPABASE_URL,process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}})}};var t=require("../../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[1638,6206,3950],()=>a(3404));module.exports=r})();